-- Write your SQL queries here, with it labelled as follows

# - Question answering, name

--Q1


--Q2, Jenna Lusk
-- How many purchases are there near Purdue?
SELECT ZIPCODE, COUNT(ZIPCODE) AS PURCHASE_COUNT 
FROM Purchase 
WHERE ZIPCODE = '47907' OR ZIPCODE = '47906' 
GROUP BY ZIPCODE;

-- OUTPUT Q2
/*
   ZIPCODE PURCHASE_COUNT
---------- --------------
     47906             10
     47907             11
*/

--Q3, Rose Elder
--What is the top 10% of locations in terms of sales?
SELECT *
FROM (
    SELECT
        FloorLocation,
        SUM(Price * Quantity) AS TotalSales
    FROM
        Purchase_Products pp
        INNER JOIN Product p ON pp.ProductID = p.ProductID
    GROUP BY
        FloorLocation
    HAVING
        SUM(Price * Quantity) >= (
            SELECT
                PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY SUM(Price * Quantity) DESC)
            FROM
                Purchase_Products pp
                INNER JOIN Product p ON pp.ProductID = p.ProductID
            GROUP BY
                FloorLocation
        )
    ORDER BY
        TotalSales DESC
    )
WHERE
    ROWNUM <= (
        SELECT
            CEIL(COUNT(*) * 0.1)
        FROM
            (
                SELECT DISTINCT
                    FloorLocation
                FROM
                    Purchase_Products pp
                    INNER JOIN Product p ON pp.ProductID = p.ProductID
            )
    );



--Q4


--Q5


--Q6, Jennifer Merry
--What month has the most rewards used and how many?
SELECT 
    TO_CHAR(TO_DATE(SUBSTR(PurchaseDate, 1, 10), 'MM/DD/YY'), 'Month') AS MonthName,
    RewardsLevel,
    COUNT(RewardsUsed) AS RewardsUsed
FROM Purchase 
JOIN Rewards ON Purchase.RewardsID = Rewards.RewardsID
GROUP BY TO_CHAR(TO_DATE(SUBSTR(PurchaseDate, 1, 10), 'MM/DD/YY'), 'Month'), RewardsLevel
ORDER BY RewardsUsed DESC;


--Q7, Rose Elder
--What floor locations have the most purchase?
SELECT p.floorlocation, SUM(pp.quantity) AS total_purchases
FROM Product p
INNER JOIN Purchase_Products pp ON p.productID = pp.productID
GROUP BY p.floorlocation
ORDER BY total_purchases DESC;


--Q8, Rose Elder
--Who are the top earning employees within their respective job title
SELECT EmpFirstName, EmpLastName, JobTitle, Pay
FROM (
    SELECT EmpFirstName, EmpLastName, JobTitle, Pay, RANK() OVER (PARTITION BY JobTitle ORDER BY Pay DESC) AS pay_rank
    FROM Employees
) ranked_employees
WHERE pay_rank = 1;


--Q9


--Q10
